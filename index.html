<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×’×©×¨ ×©×œ ××™×œ×™× - ××™×œ×•×ª ×§×™×©×•×¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&family=Fredoka:wght@500;600&display=swap" rel="stylesheet">
    
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("USa57nqXpe8fsDWtb"); 
        })();
        const SERVICE_ID = "service_wkr43mk";
        const TEMPLATE_ID = "template_a8cn3jf";
    </script>

    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #fdcb6e;
            --bg-color: #f0f3f8;
            --card-bg: #ffffff;
            --text-color: #2d3436;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#dfe6e9 1px, transparent 1px);
            background-size: 20px 20px;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: var(--card-bg);
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            padding: 30px;
            text-align: center;
            border-top: 8px solid var(--primary);
            display: flex;
            flex-direction: column;
            min-height: 80vh; /* ×’×•×‘×” ××™× ×™××œ×™ ×œ××¡×’×¨×ª */
        }

        h1 {
            font-family: 'Fredoka', sans-serif;
            color: var(--primary);
            font-size: 3rem;
            margin-top: 0;
            margin-bottom: 10px;
        }

        h2 {
            color: #636e72;
            font-size: 1.5rem;
            margin-top: 0;
            margin-bottom: 25px;
        }

        /* ×ª××•× ×ª ×¤×ª×™×—×” - ×—×¦×™ ×¢××•×“ */
        .cover-image {
            max-width: 100%;
            max-height: 45vh; 
            width: auto;
            height: auto;
            margin: 0 auto 20px auto;
            display: block;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* ×©×“×•×ª ×§×œ×˜ */
        input[type="text"] {
            font-size: 1.5rem;
            padding: 12px 20px;
            border: 2px solid #dfe6e9;
            border-radius: 50px;
            width: 60%;
            text-align: center;
            margin: 20px 0;
            font-family: 'Assistant', sans-serif;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            border-color: var(--primary);
            outline: none;
        }

        /* ×›×¤×ª×•×¨×™× */
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 40px;
            font-size: 1.6rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Fredoka', sans-serif;
            box-shadow: 0 4px 0 #4834d4;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #4834d4;
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #4834d4;
        }

        /* ×›×¤×ª×•×¨ ×“×™×œ×•×’ */
        .btn-skip {
            background-color: #b2bec3;
            box-shadow: none;
            font-size: 1.3rem;
            padding: 10px 25px;
        }

        .btn-skip:hover {
            background-color: #95a5a6;
            transform: none;
        }

        /* ×›×¤×ª×•×¨ ×”×§×•×“× */
        #prev-btn {
            background-color: #74b9ff;
            box-shadow: 0 4px 0 #0984e3;
        }
        
        #prev-btn:hover {
            background-color: #0984e3;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: auto; /* ×“×•×—×£ ×œ×ª×—×ª×™×ª */
            padding-top: 20px;
            flex-wrap: wrap;
        }

        /* ××™×›×œ ×”×ª×¨×’×™×œ×™× - ×¨×™×•×•×— ×•×¤×¨×™×¡×” */
        #exercises-container {
            display: flex;
            flex-direction: column;
            justify-content: space-evenly; /* ×¨×™×•×•×— ×©×•×•×” ×œ××•×¨×š ×”×“×£ */
            gap: 30px;
            flex-grow: 1; /* ×ª×•×¤×¡ ××ª ×›×œ ×”×’×•×‘×” ×”×¤× ×•×™ */
            margin-bottom: 20px;
            padding: 10px 0;
        }

        .sentence-row {
            background: #fff;
            border: 2px dashed var(--secondary);
            border-radius: 20px;
            padding: 25px;
            text-align: right;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            transition: transform 0.3s;
        }

        .sentence-row:hover {
            border-color: var(--primary);
            background-color: #fcfcff;
        }

        .sentence-text {
            font-size: 1.8rem;
            line-height: 2.2;
            color: var(--text-color);
            margin-bottom: 15px;
        }

        /* ××–×•×¨ ×”×’×¨×™×¨×” */
        .drop-zone {
            display: inline-block;
            min-width: 110px;
            height: 50px;
            border-bottom: 3px solid var(--primary);
            background-color: #f1f2f6;
            vertical-align: bottom;
            margin: 0 10px;
            text-align: center;
            line-height: 50px;
            font-weight: bold;
            color: var(--primary);
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
            padding: 0 15px;
        }

        .drop-zone.hovered {
            background-color: #dfe6e9;
            transform: scale(1.05);
        }

        .drop-zone.filled {
            background-color: var(--accent);
            border-bottom-color: #e1b12c;
            color: var(--text-color);
            border-bottom: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* ××—×¡×Ÿ ××™×œ×™× */
        .word-bank {
            display: flex;
            justify-content: center; /* ×××•×¨×›×– */
            gap: 15px;
            flex-wrap: wrap;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .draggable-word {
            background-color: var(--primary);
            color: white;
            padding: 8px 25px;
            border-radius: 15px;
            font-size: 1.4rem;
            cursor: grab;
            box-shadow: 0 4px 0 #4834d4;
            transition: all 0.2s;
            user-select: none;
        }

        .draggable-word:active {
            cursor: grabbing;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #4834d4;
        }

        .draggable-word.selected {
            background-color: var(--accent);
            color: var(--text-color);
            box-shadow: 0 4px 0 #e1b12c;
            transform: scale(1.1);
        }

        .draggable-word.used {
            opacity: 0.3;
            transform: scale(0.9);
            box-shadow: none;
            background-color: #b2bec3;
            cursor: default;
            pointer-events: none;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: #dfe6e9;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.4s ease-in-out;
        }

        .hidden { display: none; }
        
        /* ××¡×š ×¡×™×•× */
        .score-circle {
            width: 140px;
            height: 140px;
            background: #fff;
            border: 8px solid var(--accent);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--text-color);
            margin: 30px auto;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        @media (max-width: 600px) {
            .sentence-text { font-size: 1.4rem; }
            .draggable-word { font-size: 1.2rem; padding: 8px 15px; }
            .drop-zone { min-width: 80px; height: 40px; line-height: 40px; }
            .container { padding: 20px; min-height: 90vh; }
            .word-bank { gap: 10px; }
            .btn { padding: 10px 25px; font-size: 1.4rem; }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- ××¡×š ×¤×ª×™×—×” -->
        <div id="start-screen">
            <!-- ×”×ª××•× ×” ×©×œ×š: 1.jpg -->
            <img src="1.jpg" 
                 onerror="this.src='https://img.icons8.com/clouds/300/000000/puzzle.png'" 
                 alt="×’×©×¨ ×©×œ ××™×œ×™×" class="cover-image">
            
            <h1>×’Ö¶Ö¼×©Ö¶××¨ ×©Ö¶××œ ×Ö´×œÖ´Ö¼×™×</h1>
            <h2>×”Ö·×©Ö°××œÖ¸×Ö·×ª ×Ö´×œÖ¼×•Ö¹×ª ×§Ö´×©Ö¼××•Ö¼×¨ ×‘Ö·Ö¼×Ö´Ö¼×©Ö°××¤Ö¸Ö¼×˜</h2>
            
            <p style="font-size: 1.4rem; color: #666; margin: 20px 0;">
                ×”Ö´×›Ö°× Ö´×™×¡×•Ö¼ ×Ö¶×ª ×©Ö´××Ö°×›Ö¶× ×•Ö°×”Ö·×ªÖ°×—Ö´×™×œ×•Ö¼ ×œÖ°×—Ö·×‘ÖµÖ¼×¨ ×Ö´×©Ö°××¤Ö¸Ö¼×˜Ö´×™×!
            </p>

            <input type="text" id="studentName" placeholder="×©Öµ×× ×”Ö·×ªÖ·Ö¼×œÖ°×Ö´×™×“/×”" autocomplete="off">
            <br>
            <button class="btn" onclick="startGame()">×”Ö·×ªÖ°×—Öµ×œ ×Ö´×©Ö°×‚×—Ö¸×§!</button>
        </div>

        <!-- ××¡×š ×”××©×—×§ -->
        <div id="game-screen" class="hidden">
            <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
            
            <div id="exercises-container">
                <!-- ×›××Ÿ ×™×›× ×¡×• ×¦××“×™ ×”××©×¤×˜×™× -->
            </div>

            <div class="controls">
                <button id="prev-btn" class="btn" onclick="prevPage()">âœ ×”Ö·×§Ö¼×•Ö¹×“Öµ×</button>
                <button class="btn btn-skip" onclick="skipPage()">×“Ö·Ö¼×œÖµÖ¼×’ â©</button>
                <button class="btn" onclick="nextPage()">×”Ö·×‘Ö¸Ö¼× â¬…</button>
            </div>
        </div>

        <!-- ××¡×š ×¡×™×•× -->
        <div id="end-screen" class="hidden">
            <img src="https://img.icons8.com/color/96/000000/trophy.png" alt="×’×‘×™×¢" style="width: 120px; margin-bottom: 20px;">
            <h1>×›Ö¸Ö¼×œ ×”Ö·×›Ö¸Ö¼×‘×•Ö¹×“!</h1>
            <p style="font-size: 1.8rem; color: #555;">×¡Ö´×™Ö·Ö¼×Ö°×ªÖ¸Ö¼ ×Ö¶×ª ×”Ö·×Ö°Ö¼×©Ö´×‚×™×Ö¸×”!</p>
            
            <div class="score-circle">
                <span id="final-score">0</span>
            </div>

            <div id="sending-msg" style="color: #636e72; margin-top:20px; font-weight:bold; font-size: 1.3rem;">
                â³ ×Ö°×¢Ö·×‘ÖµÖ¼×“ × Ö°×ª×•Ö¼× Ö´×™× ×•Ö°×©××•Ö¹×œÖµ×—Ö· ×“Ö¼×•Ö¼"×—Ö·...
            </div>
            
            <button class="btn" style="background-color: #b2bec3; margin-top: 30px;" onclick="location.reload()">×”Ö·×ªÖ°×—Öµ×œ ×Öµ×—Ö¸×“Ö¸×©×</button>
        </div>
    </div>

    <script>
        // ×××’×¨ ×”××©×¤×˜×™× ×”××œ× (27 ××©×¤×˜×™×)
        const allSentences = [
            // ×“×£ 2
            { text: "×›Ö°Ö¼×©Ö¶××”Ö·×›Ö¶Ö¼×œÖ¶×‘ ×©Ö¶××œÖ´×™ ×©Ö¸×‚×Öµ×—Ö· ___ ×Ö²× Ö´×™ ×©Ö¸×‚×Öµ×—Ö·.", options: ["×Ö²×‘Ö¸×œ", "×›Ö´Ö¼×™", "×›Ö°Ö¼×“Öµ×™", "×’Ö·×"], correct: "×’Ö·×" },
            { text: "×”Ö¸×œÖ·×›Ö°×ªÖ´×™ ×œÖ´×™×©××•Ö¹×Ÿ ×Ö°×Ö»×—Ö¸×¨ ___ ×¨Ö¸×Ö´×™×ªÖ´×™ ×¡Ö¶×¨Ö¶×˜ ××•Ö¹×ªÖµ×—Ö·.", options: ["×¢Ö´×", "×Ö²×‘Ö¸×œ", "×›Ö´Ö¼×™", "×¢Ö·×œ"], correct: "×›Ö´Ö¼×™" },
            { text: "×”Öµ× Ö·×—Ö°×ªÖ´×™ ×Ö¶×ª ×”Ö·×¤Ö¶Ö¼×¨Ö·×— ×©Ö¶××§Ö¸×˜Ö·×¤Ö°×ªÖ´×™ ___ ×”Ö·×©Ö»Ö¼××œÖ°×—Ö¸×Ÿ.", options: ["×¢Ö·×œ", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°", "×Ö²×‘Ö¸×œ", "×›Ö´Ö¼×™"], correct: "×¢Ö·×œ" },
            // ×“×£ 3
            { text: "× Ö´×™×¨Ö¸×” ×¨Ö¸×¦Ö°×ªÖ¸×” ×œÖ°×¦Ö·×œÖµ× ×Ö¶×ª ×”Ö¶×—Ö¸×ª×•Ö¼×œ ___ ×”×•Ö¼× ×‘Ö¸Ö¼×¨Ö·×—.", options: ["×’Ö·×", "×Ö²×‘Ö¸×œ", "×›Ö´Ö¼×™", "×œÖ¸×›Öµ×Ÿ"], correct: "×Ö²×‘Ö¸×œ" },
            { text: "×™×•Ö¹×Ö¸×‘ ×œÖ¹× ×¢Ö¸× Ö¸×” ×¢Ö·×œ ×”Ö·×©Ö°Ö¼××Öµ×œ×•Ö¹×ª ___ ×”Ö¸×™Ö¸×” ×œ×•Ö¹ ×§Ö¸×©Ö¶××”.", options: ["×›Ö´Ö¼×™", "×¢Ö´×", "×Ö²×‘Ö¸×œ", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°"], correct: "×›Ö´Ö¼×™" },
            { text: "×©Ö´×‚×—Ö·×§Ö°×ªÖ´×™ ___ ×™Ö¸×¨×•Ö¹×Ÿ ×—Ö²×‘Öµ×¨Ö´×™ ×”Ö·×˜Ö¼×•Ö¹×‘ ×‘Ö°Ö¼×ª×•Ö¹×¤Ö¶×¡Ö¶×ª.", options: ["×œÖ°×™Ö·×“", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°", "×¢Ö´×", "×Ö¶×œ"], correct: "×¢Ö´×" },
            // ×“×£ 4
            { text: "×©Ö¸××Ö·×¢Ö°×ªÖ´×™ ×‘Ö°Ö¼×“Ö´×™×—Ö¸×” ×Ö·×¦Ö°×—Ö´×™×§Ö¸×” ___ ×¦Ö¸×—Ö·×§Ö°×ªÖ´×™.", options: ["×œÖ¸×›Öµ×Ÿ", "×¢Ö´×", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°", "×’Ö·×"], correct: "×œÖ¸×›Öµ×Ÿ" },
            { text: "×¡Ö´×¤Ö°×¨Öµ×™ ×”Ö·×§Ö°Ö¼×¨Ö´×™×Ö¸×” × Ö´×Ö°×¦Ö¸×Ö´×™× ___ ×”Ö·×Ö·Ö¼×“Ö¸Ö¼×£.", options: ["×¢Ö·×œ", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°", "×‘Ö´Ö¼×’Ö°×œÖ·×œ", "×›Ö´Ö¼×™"], correct: "×¢Ö·×œ" },
            { text: "×”Ö·×Ö¼×•Ö¹×¨Ö¸×” ×”Ö´×¦Ö´Ö¼×™×¢Ö¸×” ×œÖ°×Ö´×™×›Ö·×œ ×œÖ¸×©Ö¶××‘Ö¶×ª ___ ×Ö¸××•Ö¹×¨.", options: ["×Ö´×Ÿ", "×Ö¶×œ", "×œÖ°×™Ö·×“", "×Ö²×‘Ö¸×œ"], correct: "×œÖ°×™Ö·×“" },
            // ×“×£ 5
            { text: "× ×•Ö¹×¢Ö¸×” ×¡Ö´×“Ö°Ö¼×¨Ö¸×” ___ ×Ö²×¨×•Ö¹×Ÿ ×”Ö·×¡Ö°Ö¼×¤Ö¸×¨Ö´×™× ×•Ö¼×Ö¸×¦Ö°×Ö¸×” ×Ö·×—Ö°×‘Ö¶Ö¼×¨Ö¶×ª.", options: ["×œÖ°×™Ö·×“", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°", "×Ö¶×ª", "×Ö¶×œ"], correct: "×Ö¶×ª" },
            { text: "×œÖ¹× × Ö´×§Ö´Ö¼×™×ªÖ´×™ ×Ö¶×ª ×”Ö¶×—Ö¸×¦Öµ×¨ ___ ×©Ö¶××™Ö¸Ö¼×¨Ö·×“ ×’Ö¶Ö¼×©Ö¶××.", options: ["×‘Ö´Ö¼×’Ö°×œÖ·×œ", "×œÖ°×™Ö·×“", "×¢Ö´×", "×’Ö·×"], correct: "×‘Ö´Ö¼×’Ö°×œÖ·×œ" },
            { text: "×œÖ¸×§Ö·×—Ö°×ªÖ´×™ ×œÖ°×‘Öµ×™×ª ×”Ö·×¡ÖµÖ¼×¤Ö¶×¨ ___ ×”Ö·×§Ö°Ö¼×œÖ¸×¤Ö´×™× ×©Ö¶××œÖ´×™.", options: ["×œÖ°×™Ö·×“", "×Ö¶×ª", "×¢Ö´×", "×Ö²×‘Ö¸×œ"], correct: "×Ö¶×ª" },
            // ×“×£ 6
            { text: "×˜Ö·×œÖ´×™ ×Ö¸×¦Ö°×Ö¸×” ___ ×”Ö·×Ö·Ö¼×¤Ö°×ªÖ°Ö¼×—×•Ö¹×ª ×‘Ö°Ö¼×ª×•Ö¹×šÖ° ×”Ö·×ªÖ´Ö¼×™×§.", options: ["×œÖ°×™Ö·×“", "×Ö¶×ª", "×¢Ö´×", "×Ö¶×œ"], correct: "×Ö¶×ª" },
            { text: "×¨Ö¸×Ö´×™×ªÖ´×™ ×’Ö¼×•Ö¼×¨ ×§Ö¸×˜Ö¸×Ÿ ×•Ö°×—Ö¸××•Ö¼×“ ___ ×”Ö·×‘Ö·Ö¼×™Ö´×ª ×©Ö¶××œÖ´×™.", options: ["×©Ö¶××œ", "×œÖ°×™Ö·×“", "×¢Ö·×œ", "×¢Ö´×"], correct: "×œÖ°×™Ö·×“" },
            { text: "×Ö²× Ö´×™ ×Ö¶×”Ö°×™Ö¶×” ×‘Ö·Ö¼×‘Ö·Ö¼×™Ö´×ª ___ ×ªÖ¸Ö¼×Ö¸×¨ ×¢Ö·×“ ×”Ö¸×¢Ö¶×¨Ö¶×‘.", options: ["×›Ö´Ö¼×™", "×Ö¶×ª", "×©Ö¶××œ", "×Ö²×‘Ö¸×œ"], correct: "×©Ö¶××œ" },
            // ×“×£ 7
            { text: "×”Ö¶×—Ö¸×ª×•Ö¼×œ ×”Ö·×§Ö¸Ö¼×˜Ö¸×Ÿ ×¨Ö¸×Ö¸×” ×’Ö°Ö¼×‘Ö´×™× Ö¸×” ___ ×”Ö¸×¢Ö·×›Ö°×‘Ö¸Ö¼×¨ ×”Ö·×’Ö¸Ö¼×“×•Ö¹×œ.", options: ["×œÖ°×™Ö·×“", "×Ö¶×ª", "×‘Ö´Ö¼×’Ö°×œÖ·×œ", "×Ö²×‘Ö¸×œ"], correct: "×Öµ×¦Ö¶×œ" }, // "××¦×œ" ×‘××§×•× "×œ×™×“" (×ª×™×§×•×Ÿ ×œ×•×’×™)
            { text: "×”Ö¶×—Ö¸×ª×•Ö¼×œ × Ö´×‘Ö°×”Ö·×œ ×•Ö°×˜Ö´×¤ÖµÖ¼×¡ ×Ö·×”Öµ×¨ ___ ×”Ö·×’Ö¸Ö¼×“Öµ×¨.", options: ["×›Ö´Ö¼×™", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°", "×Ö²×‘Ö¸×œ", "×¢Ö·×œ"], correct: "×¢Ö·×œ" },
            { text: "×Ö·×‘Ö¸Ö¼× ×œÖ¸×§Ö·×— ×¡Ö»×œÖ¸Ö¼× ___ ×œÖ·×¢Ö²×œ×•Ö¹×ª ×Ö¶×œ ×”Ö¸×¢Öµ×¥.", options: ["×¢Ö´×", "×Ö¶×œ", "×›Ö°Ö¼×“Öµ×™", "×¢Ö·×œ"], correct: "×›Ö°Ö¼×“Öµ×™" },
            // ×“×£ 8
            { text: "×§Ö´×œÖ·Ö¼×¤Ö°×ªÖ´×™ ×‘Ö¸Ö¼× Ö¸× Ö¸×” ×•Ö°×–Ö¸×¨Ö·×§Ö°×ªÖ´×™ ___ ×”Ö·×§Ö°Ö¼×œÖ´×¤Ö¸Ö¼×” ×œÖ·×¤Ö·Ö¼×—.", options: ["×œÖ°×™Ö·×“", "×Ö¶×ª", "×©Ö¶××œ", "×œÖ°×ª×•Ö¹×šÖ°"], correct: "×Ö¶×ª" },
            { text: "×”Ö·×©Ö¸Ö¼××˜Ö´×™×—Ö· ×”Ö¶×—Ö¸×“Ö¸×©× ×Ö°×’Ö»×œÖ°×’Ö¸Ö¼×œ ___ ×”Ö¸×Ö¸×¨×•Ö¹×Ÿ.", options: ["×Ö¶×ª", "×©Ö¶××œ", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°", "×¢Ö´×"], correct: "×‘Ö°Ö¼×ª×•Ö¹×šÖ°" },
            { text: "×™Ö¸×¢Öµ×œ × ×•Ö¹×¡Ö·×¢Ö·×ª ×‘Ö°Ö¼×©Ö·××‘Ö¸Ö¼×ª ___ ×¡Ö·×‘Ö¸Ö¼× ×•Ö°×¡Ö·×‘Ö°×ªÖ¸Ö¼×.", options: ["×©Ö¶××œ", "×Ö¶×œ", "×›Ö°Ö¼×“Öµ×™", "×›Ö´Ö¼×™"], correct: "×Ö¶×œ" },
            // ×“×£ 9
            { text: "×¨Ö¸×¦Ö´×™×ªÖ´×™ ×œÖ°×©Ö·×‚×—Öµ×§ ×¢Ö´× ×Ö²×—×•Ö¹×ªÖ´×™ ___ ×”Ö´×™× ×—×•Ö¹×œÖ¸×”.", options: ["×œÖ°×™Ö·×“", "×Ö¶×ª", "×©Ö¶××œ", "×Ö²×‘Ö¸×œ"], correct: "×Ö²×‘Ö¸×œ" },
            { text: "×”Ö·×‘Ö°Ö¼×’Ö¸×“Ö´×™× ×Ö°×¤Ö»×–Ö¸Ö¼×¨Ö´×™× ___ ×”Ö¸×¨Ö´×¦Ö°×¤Ö¸Ö¼×”.", options: ["×¢Ö·×œ", "×Ö¶×ª", "×©Ö¶××œ", "×Öµ×¦Ö¶×œ"], correct: "×¢Ö·×œ" },
            { text: "×”Ö·×›Ö¶Ö¼×œÖ¶×‘ ×©Ö¶××œÖ´×™ ×Ö´×ªÖ°×—Ö·×‘ÖµÖ¼× ___ ×œÖ·×Ö´Ö¼×˜Ö¸Ö¼×”.", options: ["×¢Ö·×œ", "×Ö´×ªÖ·Ö¼×—Ö·×ª", "×©Ö¶××œ", "×Ö¶×ª"], correct: "×Ö´×ªÖ·Ö¼×—Ö·×ª" },
            // ×“×£ 10
            { text: "×¨Ö¸×Ö´×™× ×•Ö¼ × Ö¸×—Ö¸×©× ×‘ÖµÖ¼×™×Ÿ ×”Ö·×©Ö´Ö¼×‚×™×—Ö´×™× ×•Ö° ___ ×‘Ö¸Ö¼×¨Ö·×—Ö°× ×•Ö¼.", options: ["×œÖ°×™Ö·×“", "×Ö¶×ª", "×œÖ¸×›Öµ×Ÿ", "×’Ö·×"], correct: "×œÖ¸×›Öµ×Ÿ" },
            { text: "×”Ö¸×¢Ö´×¤Ö¸Ö¼×¨×•Ö¹×Ÿ ×Ö¸×‘Ö·×“ ×œÖ´×™ ___ ×œÖ¹× ×”Öµ×›Ö·× Ö°×ªÖ´Ö¼×™ ×Ö¶×ª ×”Ö·×©Ö´Ö¼××¢×•Ö¼×¨Ö´×™×.", options: ["×œÖ¸×›Öµ×Ÿ", "×¢Ö´×", "×‘Ö´Ö¼×’Ö°×œÖ·×œ ×©Ö¶×", "×’Ö·×"], correct: "×‘Ö´Ö¼×’Ö°×œÖ·×œ ×©Ö¶×" }, 
            { text: "×›Ö°Ö¼×©Ö¶××Ö¸×—Ö´×™ ×Ö°×§Ö·×‘ÖµÖ¼×œ ×—Ö´×‘Ö¼×•Ö¼×§ ___ ×Ö²× Ö´×™ ×¨×•Ö¹×¦Ö¶×” ×—Ö´×‘Ö¼×•Ö¼×§.", options: ["×œÖ¸×›Öµ×Ÿ", "×¢Ö´×", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°", "×’Ö·×"], correct: "×’Ö·×" }
        ];

        // ×ª×™×§×•× ×™× ×§×˜× ×™× (×× ×¦×¨×™×š)
        allSentences[18].correct = "×œÖ°×™Ö·×“"; // ××©×¤×˜ 19 (××™× ×“×§×¡ 18) - ×”×—×ª×•×œ ×•×”×’×‘×™× ×”
        allSentences[25].options = ["×œÖ¸×›Öµ×Ÿ", "×›Ö´Ö¼×™", "×‘Ö°Ö¼×ª×•Ö¹×šÖ°", "×’Ö·×"]; 
        allSentences[25].correct = "×›Ö´Ö¼×™"; // ××©×¤×˜ 26 (××™× ×“×§×¡ 25) - ×”×¢×™×¤×¨×•×Ÿ ××‘×“

        // ××©×ª× ×™ ××¢×¨×›×ª
        let currentPage = 0;
        const itemsPerPage = 2; // 2 ××©×¤×˜×™× ×‘×›×œ ×“×£
        let studentName = "";
        let userAnswers = []; // {sentence, selected, correct, isCorrect}
        let selectedWordInfo = null; // ×œ×©××™×¨×ª ××™×œ×” ×©× ×‘×—×¨×” ×‘×œ×—×™×¦×”

        function startGame() {
            const nameInput = document.getElementById("studentName");
            if (nameInput.value.trim() === "") {
                alert("× Ö¸× ×œÖ´×›Ö°×ªÖ¼×•Ö¹×‘ ×©Öµ××");
                return;
            }
            studentName = nameInput.value;
            document.getElementById("start-screen").classList.add("hidden");
            document.getElementById("game-screen").classList.remove("hidden");
            renderPage();
        }

        function renderPage() {
            const container = document.getElementById("exercises-container");
            container.innerHTML = "";
            
            // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨ ×—×–×¨×”
            const prevBtn = document.getElementById("prev-btn");
            if (currentPage === 0) {
                prevBtn.style.display = "none";
            } else {
                prevBtn.style.display = "block";
            }

            // ×¢×“×›×•×Ÿ ×¡×¨×’×œ ×”×ª×§×“××•×ª
            const progress = (currentPage / Math.ceil(allSentences.length / itemsPerPage)) * 100;
            document.getElementById("progress-fill").style.width = progress + "%";

            const start = currentPage * itemsPerPage;
            const end = start + itemsPerPage;
            const pageSentences = allSentences.slice(start, end);

            if (pageSentences.length === 0) {
                endGame();
                return;
            }

            pageSentences.forEach((q, index) => {
                const globalIndex = start + index;
                
                // ×™×¦×™×¨×ª ××–×•×¨ ×”××©×¤×˜
                const row = document.createElement("div");
                row.className = "sentence-row";
                
                const parts = q.text.split("___");
                
                row.innerHTML = `
                    <div class="sentence-text">
                        ${parts[0]}
                        <div class="drop-zone" id="zone-${globalIndex}" 
                             ondragover="allowDrop(event)" 
                             ondrop="drop(event, ${globalIndex})"
                             onclick="handleZoneClick(${globalIndex})">
                             ___
                        </div>
                        ${parts[1] || ""}
                    </div>
                    <div class="word-bank" id="bank-${globalIndex}">
                    </div>
                `;
                
                container.appendChild(row);

                // ×”×•×¡×¤×ª ×”××™×œ×™× ×œ××—×¡×Ÿ
                const bank = row.querySelector(`#bank-${globalIndex}`);
                const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
                
                shuffledOptions.forEach(word => {
                    const wordBadge = document.createElement("div");
                    wordBadge.className = "draggable-word";
                    wordBadge.innerText = word;
                    wordBadge.id = `word-${globalIndex}-${word}`;
                    wordBadge.draggable = true;
                    
                    // ×ª××™×›×” ×‘×’×¨×™×¨×”
                    wordBadge.ondragstart = (e) => drag(e, word, globalIndex);
                    // ×ª××™×›×” ×‘×œ×—×™×¦×” (×œ××•×‘×™×™×œ)
                    wordBadge.onclick = () => handleWordClick(word, globalIndex);
                    
                    bank.appendChild(wordBadge);
                });
            });
        }

        // --- ×œ×•×’×™×§×ª ××©×—×§ ---

        function allowDrop(ev) {
            ev.preventDefault();
            ev.target.classList.add("hovered");
        }

        function drag(ev, word, qIndex) {
            ev.dataTransfer.setData("text", JSON.stringify({word, qIndex}));
        }

        function drop(ev, zoneIndex) {
            ev.preventDefault();
            ev.target.classList.remove("hovered");
            try {
                const data = JSON.parse(ev.dataTransfer.getData("text"));
                if (data.qIndex === zoneIndex) {
                    placeWord(data.word, zoneIndex);
                }
            } catch(e) {}
        }

        // ×œ×—×™×¦×” ×¢×œ ××™×œ×” (××•×‘×™×™×œ/××—×©×‘)
        function handleWordClick(word, qIndex) {
            // × ×§×” ×¡×™××•×Ÿ ×§×•×“×
            document.querySelectorAll(".draggable-word").forEach(el => el.classList.remove("selected"));
            
            const el = document.getElementById(`word-${qIndex}-${word}`);
            if (!el.classList.contains("used")) {
                el.classList.add("selected");
                selectedWordInfo = { word, qIndex };
            }
        }

        // ×œ×—×™×¦×” ×¢×œ ×™×¢×“
        function handleZoneClick(qIndex) {
            if (selectedWordInfo && selectedWordInfo.qIndex === qIndex) {
                placeWord(selectedWordInfo.word, qIndex);
                
                // ××™×¤×•×¡ ×‘×—×™×¨×”
                document.querySelectorAll(".draggable-word").forEach(el => el.classList.remove("selected"));
                selectedWordInfo = null; 
            }
        }

        function placeWord(word, qIndex) {
            const zone = document.getElementById(`zone-${qIndex}`);
            zone.innerText = word;
            zone.classList.add("filled");
            zone.dataset.value = word;

            // ×¡×™××•×Ÿ ×”××™×œ×” ×›××©×•××©×ª
            const bank = document.getElementById(`bank-${qIndex}`);
            Array.from(bank.children).forEach(child => {
                child.classList.remove("used"); // ××¤×©×¨ ×œ×©× ×•×ª ×“×¢×”, ××– × ××¤×¡ ×§×•×“×
                if (child.innerText === word) {
                    child.classList.add("used");
                }
            });
        }

        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                // ××—×™×§×ª ×ª×©×•×‘×•×ª ××”×¢××•×“×™× ×©×”×™×™× ×• ×‘×”× ×›×“×™ ×œ××¤×©×¨ ×ª×™×§×•×Ÿ
                const itemsToKeep = currentPage * itemsPerPage;
                if (userAnswers.length > itemsToKeep) {
                    userAnswers = userAnswers.slice(0, itemsToKeep);
                }
                renderPage();
            }
        }
        
        function skipPage() {
            saveAnswers(true); 
            goToNext();
        }

        function nextPage() {
            saveAnswers(false);
            goToNext();
        }
        
        function saveAnswers(skipped) {
            const start = currentPage * itemsPerPage;
            const end = Math.min(start + itemsPerPage, allSentences.length);

            for (let i = start; i < end; i++) {
                if (userAnswers.length > i) {
                     // ×× ×›×‘×¨ ×§×™×™× - ×œ× ×“×•×¨×¡×™× ××œ× ×× ×›×Ÿ ××ª×§× ×™×
                }
                
                const zone = document.getElementById(`zone-${i}`);
                let selected = "(×œ× ×¢× ×”)";
                // ×× ×œ× ×“×™×œ×’×• ×•×™×© ×¢×¨×š - ×œ×•×§×—×™× ××•×ª×•
                if (!skipped && zone && zone.dataset.value) {
                    selected = zone.dataset.value;
                }
                
                const correct = allSentences[i].correct;
                
                userAnswers.push({
                    question: allSentences[i].text.replace("___", "____"),
                    selected: selected,
                    correct: correct,
                    isCorrect: selected === correct
                });
            }
        }

        function goToNext() {
            currentPage++;
            if (currentPage * itemsPerPage >= allSentences.length) {
                endGame();
            } else {
                renderPage();
            }
        }

        function endGame() {
            document.getElementById("game-screen").classList.add("hidden");
            document.getElementById("end-screen").classList.remove("hidden");
            
            const correctCount = userAnswers.filter(a => a.isCorrect).length;
            const grade = Math.round((correctCount / allSentences.length) * 100);
            
            document.getElementById("final-score").innerText = grade;
            
            sendReport(grade, correctCount);
        }

        function sendReport(grade, correctCount) {
            const date = new Date().toLocaleDateString("he-IL");
            const percentage = Math.round((correctCount / allSentences.length) * 100);

            // --- ×œ×•×’×™×§×” ×¤×“×’×•×’×™×ª ×œ×“×™×•×•×— (×ª×•×××ª ×œ×‘×§×©×”) ---
            let masteryLevel = "";
            let diagnosis = "";
            let recommendation = "";
            let feedbackColor = "red";

            if (grade >= 90) {
                masteryLevel = "××¦×•×™×Ÿ";
                diagnosis = "×”×ª×œ××™×“ ××’×œ×” ×”×‘× ×” ×¢××•×§×” ×©×œ ×”×§×©×¨×™× ×”×œ×•×’×™×™× ×‘××©×¤×˜ (×¡×™×‘×”, ×ª×•×¦××”, × ×™×’×•×“ ×•×”×•×¡×¤×”).";
                recommendation = "××•××œ×¥ ×œ××ª×’×¨ ××ª ×”×ª×œ××™×“ ×‘×›×ª×™×‘×ª ×¤×¡×§××•×ª ××•×¨×›×‘×•×ª ×”××©×œ×‘×•×ª ××¡×¤×¨ ××™×œ×•×ª ×§×™×©×•×¨, ××• ×‘××˜×œ×•×ª ×©×œ ×©×›×ª×•×‘ ×˜×§×¡×˜×™×.";
                feedbackColor = "green";
            } else if (grade >= 70) {
                masteryLevel = "×˜×•×‘";
                diagnosis = "×”×ª×œ××™×“ ××‘×™×Ÿ ××ª ××‘× ×” ×”××©×¤×˜ ××š ×œ×¢×™×ª×™× ××ª×‘×œ×‘×œ ×‘×™×Ÿ ××™×œ×•×ª ×§×™×©×•×¨ ×‘×¢×œ×•×ª ×ª×¤×§×™×“ ×“×•××” (×›××• '×‘×’×œ×œ' ×•'×›×™') ××• ××™×œ×•×ª ×™×—×¡.";
                recommendation = "××•××œ×¥ ×œ×ª×¨×’×œ ××ª ×”×”×‘×“×œ×™× ×”×“×§×™× ×‘×™×Ÿ ×”××™×œ×™× ×•×œ×‘×§×© ××”×ª×œ××™×“ ×œ×”×§×¨×™× ××ª ×”××©×¤×˜ ×”×©×œ× ×•×œ× ××§ ××ª ×‘×—×™×¨×ª×•.";
                feedbackColor = "orange";
            } else {
                masteryLevel = "× ×“×¨×© ×—×™×–×•×§";
                diagnosis = "× ×™×›×¨ ×§×•×©×™ ×‘×”×‘× ×ª ×”×§×©×¨ ×”×œ×•×’×™ ×‘×™×Ÿ ×—×œ×§×™ ×”××©×¤×˜ ×•×‘×”×ª×××ª ××™×œ×ª ×”×§×™×©×•×¨ ×”××ª××™××”.";
                recommendation = "××•××œ×¥ ×œ×—×–×•×¨ ×œ×‘×¡×™×¡: ×¢×‘×•×“×” ×¢×œ ××©×¤×˜×™× ×¤×©×•×˜×™×, ×©×™××•×© ×‘×›×¨×˜×™×¡×™×•×ª ×¤×™×–×™×•×ª, ×•×”×“×’××” ××•×—×©×™×ª ×©×œ ×”×§×©×¨×™× ×”×œ×•×’×™×™×.";
                feedbackColor = "red";
            }

            // ×¨×©×™××ª ×˜×¢×•×™×•×ª (××™×œ×™× ×œ×—×™×–×•×§)
            const wrongAnswers = userAnswers.filter(a => !a.isCorrect);
            const wrongWordsList = wrongAnswers
                .map(a => a.correct) 
                .filter((v, i, a) => a.indexOf(v) === i) 
                .join(", ");
                
            let focusArea = "";
            if (wrongAnswers.length > 0) {
                // ×‘× ×™×™×ª ×¨×©×™××ª ×”××©×¤×˜×™× ×”×©×’×•×™×™× ×œ×ª×¦×•×’×” ×‘×“×•"×— (×›×¤×™ ×©×‘×™×§×©×ª)
                let sentencesList = "<ul style='margin-top:10px; padding-right:20px; list-style-type:circle;'>";
                wrongAnswers.forEach(item => {
                    // ××“×’×™×© ××ª ×”××™×œ×” ×”×©×’×•×™×” ×‘×ª×•×š ×”××©×¤×˜
                    const badSentence = item.question.replace("____", `<span style='color:red; text-decoration:underline;'>${item.selected}</span>`);
                    sentencesList += `<li style='margin-bottom:5px;'>${badSentence} (×”× ×›×•×Ÿ: <strong>${item.correct}</strong>)</li>`;
                });
                sentencesList += "</ul>";

                focusArea = `<div style="margin-top:15px; border-top:1px dashed #ccc; padding-top:10px;"><strong>××™×œ×™× ×œ×—×™×–×•×§ (×˜×¢×•×™×•×ª ×©× ×¨×©××•):</strong><br><span style="color:#d35400;">${wrongWordsList}</span>.</div>`;
                focusArea += `<div style="margin-top:15px;"><strong>×¤×™×¨×•×˜ ×”××©×¤×˜×™× ×”×©×’×•×™×™×:</strong>${sentencesList}</div>`;
            } else {
                focusArea = `<div style="margin-top:10px;"><strong>××™×œ×™× ×œ×—×™×–×•×§:</strong> ××™×Ÿ. ×‘×™×¦×•×¢ ××•×©×œ×.</div>`;
            }

            // --- ×‘× ×™×™×ª ×”-HTML ×©×œ ×”×“×•"×— (××‘× ×” ×§×‘×•×¢) ---
            let reportHTML = `<div dir="rtl" style="font-family: Arial, sans-serif; color:#333; line-height:1.6;">`;
            
            // ×›×•×ª×¨×ª - ×›×—×•×œ ×‘×”×™×¨
            reportHTML += `<div style="background-color:#81ecec; padding:15px; border-radius:8px 8px 0 0; text-align:center;">`;
            reportHTML += `<h2 style="margin:0; color:#2d3436;">×“×•×— ××™×•×× ×•×ª: ×©×™××•×© ×‘××™×œ×•×ª ×§×™×©×•×¨</h2></div>`;
            
            // ×¤×¨×˜×™× ××™×©×™×™×
            reportHTML += `<div style="padding:20px; border:1px solid #ddd; border-top:none; background:#fff; border-radius:0 0 8px 8px;">`;
            reportHTML += `<div><strong>×©× ×”×ª×œ××™×“:</strong> ${studentName}</div>`;
            reportHTML += `<div><strong>×ª××¨×™×š ×”×‘×™×¦×•×¢:</strong> ${date}</div>`;
            // ×¦×™×•×Ÿ + ××—×•×–×™ ×”×¦×œ×—×”
            reportHTML += `<div style="margin-top:5px;"><strong>×¦×™×•×Ÿ ×¡×•×¤×™:</strong> <span style="color:${feedbackColor}; font-weight:bold;">${grade}</span> (${percentage}% ×”×¦×œ×—×” - ${correctCount} ××ª×•×š ${allSentences.length} ×ª×©×•×‘×•×ª × ×›×•× ×•×ª)</div>`;
            
            reportHTML += `<hr style="margin:20px 0; border:0; border-top:1px solid #eee;">`;
            
            // × ×™×ª×•×— ×¤×“×’×•×’×™ ×•××¡×§× ×•×ª
            reportHTML += `<h3 style="color:#2d3436; margin-bottom:10px;">ğŸ“Š × ×™×ª×•×— ×¤×“×’×•×’×™ ×•××¡×§× ×•×ª:</h3>`;
            reportHTML += `<div><strong>×¨××ª ×©×œ×™×˜×”:</strong> ${masteryLevel}</div>`;
            reportHTML += `<div style="margin-top:5px;"><strong>××‘×—×•×Ÿ:</strong> ${diagnosis}</div>`;
            reportHTML += `<div style="margin-top:5px;"><strong>×”××œ×¦×” ×œ×”××©×š ×¢×‘×•×“×”:</strong> ${recommendation}</div>`;
            reportHTML += focusArea;
            
            reportHTML += `</div></div>`; // ×¡×’×™×¨×ª ×”-DIV ×”×¨××©×™

            const params = {
                subject: `×’×©×¨ ×©×œ ××™×œ×™× - ××™×œ×•×ª ×§×™×©×•×¨ - ${studentName}`,
                student_name: studentName,
                score: grade,
                report_details: reportHTML
            };

            emailjs.send(SERVICE_ID, TEMPLATE_ID, params)
                .then(() => {
                    document.getElementById("sending-msg").innerText = "×”×“×•×— × ×©×œ×— ×‘×”×¦×œ×—×” ×œ××•×¨×” âœ…";
                    document.getElementById("sending-msg").style.color = "green";
                })
                .catch((err) => {
                    console.error(err);
                    document.getElementById("sending-msg").innerText = "×©×’×™××” ×‘×©×œ×™×—×ª ×”×“×•×— âŒ";
                });
        }
    </script>
</body>
</html>
